---
layout: post
draft: true
title: First draft post!
image: /img/hello_world.jpeg
---

Decentralized Exchanges are a hot topic in the blockchain community. Many are touting them as the ultimate solution to enable global bitcoinization. With so many _DEX_ projects coming on-line, lets first ask: What is a _DEX_? Its a Decentralized Exchange. So, What is an exchange? 

# Exchange 
Say you are interested in buying Altcoin with ticker _$ALT_. Your are  interestested in owning _$ALT_ itself, as an investor or user. In contrast to a trader, who does not care about owning _$ALT_, but is just trading to earn more profits in Bitcoin. We will get to the trader in a bit. 

You are holding Bitcoin and want to purchase Altcoin, the price ticker is _$ALTBTC_. To do this, you need to go find someone holding _$ALT_ that wants bitcoin, and is willing to sell it to you. You can put adds on craigslist, ask friends, and post on social media. Better yet, what if there is a central place where everyones goes that wants to trade _$ALTBTC_? 

**An Exchange, is like a marketplace, a physical or virtual place where like minded people go to buy or sell Altcoin.**

![bucket](http://images.marketchess.com/im/9588/bucket-shops-stock-market.jpg)

One of the earliest "exchanges" was the Tontine Coffee House in New York City, in the late 1700s, which later became the New York Stock Exchange. Even at a designated exchange, finding a seller with the right quantity and price can take all day, days, weeks or months. Brokers saw a business opportunity, where for a commission, they will stay at the exchange all-day - every day and watch the markets for you. 

Bucket-Shops were are new kind of "exchange" where you can bet on stock prices, but never actuality did any buying or selling at all. One of the most successful speulators of all-time, Jesse Lauriston Livermore, began trading at bucket shops, before becoming a professional wall street traders and speculator.  The book, [Reminiscences of a Stock Operator](https://www.trendfollowing.com/whitepaper/Edwin_LeFevre_Reminiscences_of_a_Stock_Operator.pdf), is a fictional account of his life, and is a must read for anyone interested in the art of trading and speculation. 

## Traders vs Investors  / Alpha vs Beta
Traders, speculators, and market-makers will buy and sell any asset for the sole purpose of profiting by buying low and selling high. In one sense, traders get paid for providing liquidity to the true buyers, the investors or users. Advanced trading strategies emerged such as "short selling", where a trader would borrow stock from a broker, and then immediately sell it and hold on to the cash.  They would then wait for the price to drop, use some of the cash to buy it back, return the stock to the lender, and keep the remaining cash as profit! 

Investors are seeking liquidity, and traders are seeking profit, and neither one wants to take on the risk that the other side of the trade will default or reneg. Hence the modern financial markets were born. 

Exchanges would match buyers and sellers and create a single "book" of liquidity, while charging an exchange fee for each trade in return for guaranteeing settlement and clearing. They achieved this by only allowing pre-qualified members of the exchange trade. These members would consist of mostly two groups, investment brokers and floor traders.  

Beta is the returns from market movement of the underlying asset itself, while Alpha is the excessive returns that are independent of the underlying market price. Alpha relects you net profit and loss from trading. Beta reflects your profit and loss in relation to an underlying asset. So an investment portfolio with 100% $ALT, has a Beta of 1 vs $ALT. 

Exchanges volumes have always been dominated by traders over investors. By the 80s and 90s, due to computer trading, the internet, and day-traders, 90% of all volume was coming from traders, with only 10% from investors.  High-Frequency-Tradin, or "stat-arb" ,took this to the next level. Today, "Alpha" traders make up to 99% of all trading activity. HFT activity alone, went from 10% of volume in in 2000 to 80% in 2017! [source](https://www.techstars.com/content/startup-digest/history-high-frequency-trading-hft-infographic/)

![limitorderbook](/img/limitorderbook.png)
Modern exchanges cater to both the Beta investor and the Alpha traders, by providing a "central limit order book", a single book of liquidity sorted first by price and then by time. Creating a fair open efficient market, for optimal price discovery.   

### Exchanges provide:
* Custody: Settlement and Clearing of trades, plus transfer of assets. This removes the need for buyers and sellers to trust eachother.  
* Liquidity: Matching and Execution of trades, through a single central limit order book. This pools liquity from Alpha traders as well as investors, enabling best prive execution and price discovery. 

# Decentralized Exchange
## Ultimate Goal 
An exchange that provides price discovery by matching buyers and sellers from a deep pool of liquidity with tranparency, immutibility, and censorship rsistance. Where buyers and sellers are open participants of the exchange, are always in custody of their own assets, and may remain psudo-anonymous. 

What does "Decentralized" mean in a DEX? 
* Decentralized Custody: Settlement and Clearing without a centralized custodian. 
* Decentralized Liquidity: Matching and Execution of trades through a decentralized limit order book. This requires the macthing engine to be distributed on each users machine. 

Most DEXs today are trying to solve the problem of settlement and clearing without centralized custody. This makes sense, because with  bitcoin we no longer always need a central authority for asset transfers.  However, without pooling liquity together, they are ignoring the needs of 99% of tranditional exchange volume. These DEXs are geared towards the investors and users, who are looking find buyers and sellers, and are  similar to OTC (Over-The-Counter) tradnig desks. OTC desks, privately match buyers and sellers at negotiated prices, which are independent of the current prices from the liquid exchanges. 

Decentralized custody is an almost impossible problem to solve, but with atomic swap technology many projects are almost there. There still are fundamental problems with these solutions, but we are not going to into those here. Becuase there is an even bigger problem, that we need to discuss. Decentralized Liquidity. 

Price discovery and liquity are the main purpose of any exchange. For a DEX to compete with a centralized exchange it must also create deep liquity by attracking algorithmic traders, who make up over 90% of volume. However decentralized limit-order books are impossible, due to _Adverse Selection Risk_ a.k.a front-running

> DEXs are only interesting if they can compete with centralized exchanges in providing deep liquidity. 

## Good News and Bad News
The good news is that decentralized custody, clearing, and settlement is already solved with blockchain. The bad news is:  even when decentralized custody, clearing, and settlement is completly solved, decentralized exchanges are still impossible!  

> An account based blockchain with more than a single asset, can have a native on-chain "exchange" with a limit order book. Users place buy and sell orders by signing special blockchain transactions. Each node has a complete matching-engine and limit-order book built in, and processes the buy and sell orders from the block of transactions. After each trade execution, each node will automatically debit and credit funds and assets from the buyers and sellers. 

* In fact, many blockchains already have decentralized matching engines i production! Such as, _XRP_, _Bitshares_, _Counterparty_, _Protoblock_, _Ethereum_, and _NXT_, to name a few. *

Of course this can only work with assets from inside the blockchain itself. 

## Adverse Selection Risk (ASR) 
The ability for miners to front-run yor orders, means that your orders only get filled when its not in your favor. Your adversaries are selectivly filling your orders, only when its profitable for them. 
 
"Central Limit Order Books" are path dependant, transaction ordering matters. Bitcoin and Proof-of-Work solve double-spend, which only requires miners to decide which tx goes into a block in case of a double spend. Transaction order inside a block has no effect on bitcoin UTXOs. Miners are free to order the transaction in any way. However transaction order is a fundamental property of exchange matching engines. 

In fact, the term "Central Limit Order Book", has been used since the 1980s, as exchanges quickly discovered that matching-engines need to be run on a single thread in a single computer. In fact, the reason for this is same Byzabteme Generals Problem solved by Bitcoin! 

## Front-Running 

### Flash Crash 

These 7 orders should go though the matching engine and produce the following. 

```javascript
1. trader1: Buy   5 at 500 
2. trader1: Sell  5 at 1500 
3. trader2: Buy   1 at 950
4. trader3: Sell  1 at 955
5. trader4: Sell  2 at 95 
6. trader1: Sell  1 at 940 
7. trader5: Buy   2 at 950 
```

![book11](/img/book11.png)
![book12](/img/book12.png)
![book13](/img/book13.png)
![book14](/img/book14.png)

Now lets see what happens if we just reorder transaction 5 and 7. 

```javascript
1. trader1: Buy   5 at 500 
2. trader1: Sell  5 at 1500 
3. trader2: Buy   1 at 950
4. trader3: Sell  1 at 955
5. trader5: Buy   2 at 950 
6. trader1: Sell  1 at 940 
7. trader4: Sell  2 at 95 
```

![book21](/img/book21.png)

* trader4 went from -45% to breakeven *
* trader1 went from flat with +845 profit to short 2 at 950 *

A change in a single transaction created a 45% in traders P&L. What if instead a miner did the following? 
```javascript
1.  trader1: Buy   5 at 500 
2.  trader1: Sell  5 at 1500 
4.  trader3: Sell  1 at 955
5.  miner:   Buy   2 at 501
6.  miner:   Sell  2 at 940 
7.  trader4: Sell  2 at 95 
8.  trader2: Buy   1 at 950
9.  trader1: Sell  1 at 940 
10. trader5: Buy   2 at 950 
```

![book31](/img/book31.png)


Long 2 at 501
Sell 2 at 950

Miner just made 889% in the trade, and is up $1690! and with no risk! 





miners only have the power to chose one side of a double spent.    

only solve 



> Decentralized liquity is impossible, becuase of front running.  

## A Possible Solution
https://www.youtube.com/watch?v=fYr-keVOQ18

We take inspiration from the inventors of linked-timestaming, the precursor to the blockchain. Scott Stornetta and Steward Habor found it impossible to solve the problem of creating immutible digitial records, because anyone who had access, could change it, even a  group of people watching over the data could ultimatly collude. The solution was a conspioracy so large that every one in the world must be in on it. The inverted the problem, by making the data widely distributed and public. 

Distributed Order-books are impossible, since there is no way to reach consensus on the order of the transactions. This gives each miner the ability to front-run, and take free money, causing adverse-slection risk to all traders at the exchange, which would kill liquidity and not compete with centralized systems. 

What if we look at this "front-running" as a block-reward? In normal blockchains, miner need to be incentivised with block-rewards. However, what if we make a new blockchain, only miners would have to Pay to sign blocks? What are they paying for? They are paying for the right to re-order the blocks. 
